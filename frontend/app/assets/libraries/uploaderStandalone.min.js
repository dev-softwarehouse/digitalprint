!function(t){function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}var e={};i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=1)}([function(t,i,e){"use strict";function a(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function n(t,i,e){i=i||"",e=e||258;for(var a=atob(t),n=[],o=0;o<a.length;o+=e){for(var s=a.slice(o,o+e),r=new Array(s.length),h=0;h<s.length;h++)r[h]=s.charCodeAt(h);var d=new Uint8Array(r);n.push(d)}return new Blob(n,{type:i})}var o=function(){function t(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(i,e,a){return e&&t(i.prototype,e),a&&t(i,a),i}}(),s=function(){function t(i){a(this,t),this.thumbMaker=new r,this.uploadButton=i.uploadButton,this.uploadServerUrl=i.uploadServerUrl,this.onStartUpload=i.onStartUpload,this.onUploadedItem=i.onUploadedItem,this.initUploading(),this.loadedFileCallback=i.loadedFileCallback||function(){},this.contextMakerCallback=i.onLoadedItem,this.isUploading=!1,this.toUpload=[],this.uploaded=[],this.isPreparingMiniatures=!1}return o(t,[{key:"uploadFunction",value:function(){}},{key:"changedFiles",value:function(t){this.files=t.target.files,this.loadFiles()}},{key:"startUpload",value:function(){this.isUploading||(this.isUploading=!0,this.toUpload.length?this.uploadImage(this.toUpload.shift()):this.isUploading=!1)}},{key:"uploadImage",value:function(t){var i=this,e=new FormData;e.append("minSize",JSON.stringify(t.minSize)),e.append("thumbSize",JSON.stringify(t.thumbSize)),e.append("userFile",t.tmp_file),e.append("origin",JSON.stringify({width:t.origin.width,height:t.origin.height}));var a=this.onStartUpload(e,t),n=new XMLHttpRequest;n.open("POST",this.uploadServerUrl,!0),n.onerror=function(t){console.log(t),console.log("Wystąpił bąd podczas pobierania pliku!")},n.upload.addEventListener("progress",function(i){var e=parseInt(i.loaded/i.total*100);t.updateProgress(e)}),n.onreadystatechange=function(e){4==n.readyState&&(i.onUploadedItem(t,JSON.parse(n.response)),t.isUploaded(),i.isUploading=!1,i.startUpload())},n.send(a)}},{key:"loadFiles",value:function(){function t(){i++,e.files[i]?(e.isPreparingMiniatures=!0,e.loadSingleFile(i,t)):(e.files=[],e.isPreparingMiniatures=!1)}var i=-1,e=this;t()}},{key:"loadSingleFile",value:function(t,i){var e=new h(this.files[t],this.thumbMaker),a=this;e.createMiniatures(function(t){a.loadedFileCallback(t),a.contextMakerCallback(t,function(){a.toUpload.push(e),a.startUpload()})}),i()}},{key:"initUploading",value:function(){this.uploadButton.addEventListener("change",function(t){this.isPreparingMiniatures?alert("Poczekaj aż wszystkie miniatury zostaną utworzone."):this.changedFiles(t)}.bind(this))}}]),t}(),r=function(){function t(){a(this,t),this.settings={maxsize:500,minMaxSize:130},this.thumbWidth,this.thumbHeight,this.minThumbWidth,this.minThumbHeight,this.thumbGenerator,this.minThumbGenerator,this.thumbinator,this.canvas,this.thumbCanvas,this.minCanvas;var i=document.createElement("canvas");i.id="thumbMaker";var e=document.createElement("canvas");e.id="minMaker",document.body.appendChild(i),document.body.appendChild(e);this.thumbCanvas=document.getElementById("thumbMaker"),this.minCanvas=document.getElementById("minMaker")}return o(t,[{key:"resizeImage",value:function(t,i,e){var a=null,o=null,s=this.minCanvas.getContext("2d"),r=this.thumbCanvas.getContext("2d");if(this.minCanvas.width=0,this.minCanvas.height=0,this.thumbCanvas.width=0,this.thumbCanvas.height=0,t.origin.width>t.origin.height)var h=Math.ceil(Math.log(t.origin.width/650)/Math.log(2));else var h=Math.ceil(Math.log(t.origin.height/650)/Math.log(2));if(h>0){var d=.5*t.origin.width,l=.5*t.origin.height;this.minCanvas.width=d,this.minCanvas.height=l;for(var u=1;u<h;u++)(d>700||l>700)&&(d*=.5,l*=.5);this.minCanvas.width=d,this.minCanvas.height=l,s.drawImage(t.image,0,0,this.minCanvas.width,this.minCanvas.height),o=this.minCanvas.toDataURL();var p=n(o.split("data:image/png;base64,")[1],"image/png"),g=window.URL||window.webkitURL,m=g.createObjectURL(p);o=m}else{var d=t.origin.width,l=t.origin.height;this.minCanvas.width=d,this.minCanvas.height=l,s.drawImage(t.image,0,0,this.minCanvas.width,this.minCanvas.height),o=this.minCanvas.toDataURL();var p=n(o.split("data:image/png;base64,")[1],"image/png"),g=window.URL||window.webkitURL,m=g.createObjectURL(p);o=m}if(t.origin.width>t.origin.height)var c=Math.ceil(Math.log(t.origin.width/150)/Math.log(2));else var c=Math.ceil(Math.log(t.origin.height/150)/Math.log(2));if(c){var v=.5*t.origin.width,f=.5*t.origin.height;this.thumbCanvas.width=v,this.thumbCanvas.height=f;for(var u=1;u<c;u++)(v>250||f>250)&&(v*=.5,f*=.5);this.thumbCanvas.width=v,this.thumbCanvas.height=f,r.drawImage(t.image,0,0,this.thumbCanvas.width,this.thumbCanvas.height),a=this.thumbCanvas.toDataURL();var p=n(a.split("data:image/png;base64,")[1],"image/png"),g=window.URL||window.webkitURL,m=g.createObjectURL(p);a=m}else{var d=t.origin.width,l=t.origin.height;this.thumbCanvas.width=d,this.thumbCanvas.height=l,r.drawImage(t.image,0,0,this.thumbCanvas.width,this.thumbCanvas.height),a=this.thumbCanvas.toDataURL();var p=n(a.split("data:image/png;base64,")[1],"image/png"),g=window.URL||window.webkitURL,m=g.createObjectURL(p);a=m}r.clearRect(0,0,this.thumbCanvas.width,this.thumbCanvas.height),s.clearRect(0,0,this.minCanvas.width,this.minCanvas.height),i.minImage=o,i.thumbImage=a,i.thumbSize={width:this.thumbCanvas.width,height:this.thumbCanvas.height},i.minSize={width:this.minCanvas.width,height:this.minCanvas.height},e({context:i,min:o,thumb:a,thumbSize:{width:this.thumbCanvas.width,height:this.thumbCanvas.height},minSize:{width:this.minCanvas.width,height:this.minCanvas.height}})}}]),t}(),h=function(){function t(i,e){a(this,t),this.tmp_file=i,this.thumbMaker=e}return o(t,[{key:"updateProgress",value:function(t){this.elem.querySelector(".status").style.width=t+"%"}},{key:"setElement",value:function(t){this.elem=t}},{key:"isUploaded",value:function(){this.elem.className+=" loaded",this.tmp_file=null}},{key:"createMiniatures",value:function(t,i){this._image=new Image,this._image.crossOrigin="anonymous";var e=URL.createObjectURL(this.tmp_file);this._image.src=e;var a=this,n=new createjs.Bitmap(this._image);n.image.onload=function(){URL.revokeObjectURL(e),e=null,n.origin=n.getBounds(),n.scale={x:n.origin.width,y:n.origin.height},a.origin=n.origin,a.thumbMaker.resizeImage(n,a,t)}}},{key:"upload",value:function(){var t=this,i=this.tmp_file;this.miniature,this.thumbnail;this.loadedInfo=0;var e=new FormData;e.append("userFile",i),e.append("userProjectID",this.editor.userProject.getID()),e.append("objectID",this.dbID),e.append("userID",this.editor.user.getID()),e.append("companyID",this.editor.config.getCompanyID()),e.append("minSize",JSON.stringify(this.minSize)),e.append("thumbSize",JSON.stringify(this.thumbSize)),this.requestUpload=new XMLHttpRequest,this.addEventListener("uploaded",function(i){i.stopPropagation(),t.tmp_file=null});var a=this;this.requestUpload.onerror=function(t){console.log(t),console.log("Wystąpił bąd podczas pobierania pliku!")},this.requestUpload.upload.addEventListener("progress",function(i){var e=document.createEvent("Event");e.initEvent("progress",!0,!1),e.progress=parseInt(i.loaded/i.total*100),t.statusBar.dispatchEvent(e);var n=parseInt($(".uploadingInfo .uploadInfoLoaderText").attr("loaded"))||0;n+=i.loaded-t.loadedInfo;parseInt($(".uploadingInfo .uploadInfoLoaderText").attr("total"));$(".uploadingInfo .uploadInfoLoaderText").attr("loaded",n);var o=$(".uploadingInfo .uploadInfoLoaderText").attr("to-upload");a.headerSize||(a.headerSize=i.total-a.fileSize,$(".uploadingInfo .uploadInfoLoaderText").attr("to-upload",parseInt(o)+a.headerSize)),$(".uploadingInfo .uploadInfoLoaderText").html(parseInt(n/o*100)+"%");var s=parseInt($(".uploadingInfo").attr("c-estimator"))||0;s++,$(".uploadingInfo").attr("c-estimator",s);var r=parseInt($(".uploadingInfo").attr("v-estimator"))||0;if(r+=i.loaded-t.loadedInfo,$(".uploadingInfo").attr("v-estimator",r),1==s&&($(".uploadingInfo").attr("tstart-estimator",parseInt(Date.now())),$(".uploadingInfo").attr("v-estimator",0)),50==s&&($(".uploadingInfo").attr("tstop-estimator",parseInt(Date.now())),$(".uploadingInfo").attr("c-estimator",0),$(".uploadingInfo .estimation").html("Szacowany czas: "+parseInt(Math.ceil((parseInt($(".uploadingInfo .uploadInfoLoaderText").attr("to-upload"))-parseInt($(".uploadingInfo .uploadInfoLoaderText").attr("loaded")))/parseInt($(".uploadingInfo").attr("v-estimator"))*(parseInt($(".uploadingInfo").attr("tstop-estimator"))-parseInt($(".uploadingInfo").attr("tstart-estimator")))/1e3/60))+" minut")),$(".uploadingInfo .uploadInfoLoaderProgress").width(parseInt(n/o*100)+"%"),n/o*100>=100){$(".uploadingInfo").addClass("hidden");var h=$("#imagesContent").height()-$("#imagesContent .containerButtons").outerHeight()-$("#imageLoaderInfo").outerHeight()-20;$("#imagesListScroll").height(h)}else $(".uploadingInfo").removeClass("hidden");t.loadedInfo=i.loaded}),this.requestUpload.open("POST",this.editor.config.getDomain()+":"+this.editor.config.getPort()+"/userUpload/projectImage",!0),this.requestUpload.onreadystatechange=function(i){if(4==a.requestUpload.readyState){var e=JSON.parse(a.requestUpload.responseText);t.uploaded=!0,t.alpha=1;var n=(e.url,e.minUrl,window.URL||window.webkitURL);n.revokeObjectURL(t.imageUrl);var n=window.URL||window.webkitURL;n.revokeObjectURL(t.miniatureUrl);var n=window.URL||window.webkitURL;n.revokeObjectURL(t.thumbnail),t.imageUrl=e.url,t.miniatureUrl=t.miniature=t.minUrl=e.minUrl,t.thumbnail=e.thumbUrl,t.uploadID=e._id,t.dispatchEvent("uploaded"),a.requestUpload=null,callback(t)}},delete this.tmp_image}}]),t}();window.UploaderStandalone=s},function(t,i,e){t.exports=e(0)}]);